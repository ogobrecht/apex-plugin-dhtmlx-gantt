/**
 * Oracle APEX plugin dhtmlxGantt helper - v0.9.0 - 2018-09-30
 * https://github.com/ogobrecht/apex-plugin-dhtmlx-gantt
 * Copyright (c) 2017-2018 Ottmar Gobrecht - GPLv2 license
 */
window.plugin_dhtmlxGantt={},plugin_dhtmlxGantt.version="0.9.0",plugin_dhtmlxGantt.init=function(){plugin_dhtmlxGantt.regionIdElement=apex.jQuery("#"+plugin_dhtmlxGantt.regionId),plugin_dhtmlxGantt.chartContainerIdElement=apex.jQuery("#"+plugin_dhtmlxGantt.chartContainerId),plugin_dhtmlxGantt.regionIdElement.bind("apexrefresh",function(){plugin_dhtmlxGantt.load()}),plugin_dhtmlxGantt.pageItemsToSubmit=""!==plugin_dhtmlxGantt.pageItemsToSubmit&&plugin_dhtmlxGantt.pageItemsToSubmit.replace(/\s/g,"").split(","),gantt.attachEvent("onTaskDblClick",function(a){if(a){var b=gantt.getTask(a);return b.url_edit&&plugin_dhtmlxGantt.util_openUrl(b.url_edit),apex.event.trigger(plugin_dhtmlxGantt.chartContainerIdElement,"dhtmlxgantt_task_double_click",b),!1}return!0}),gantt.attachEvent("onTaskCreated",function(a){return a.parent?(a.parent=gantt.getTask(a.parent),a.parent.url_create_child&&plugin_dhtmlxGantt.util_openUrl(a.parent.url_create_child)):plugin_dhtmlxGantt.dataParsed.task_create_url_no_child.url&&plugin_dhtmlxGantt.util_openUrl(plugin_dhtmlxGantt.dataParsed.task_create_url_no_child.url),apex.event.trigger(plugin_dhtmlxGantt.chartContainerIdElement,"dhtmlxgantt_task_create",a),!1}),gantt.attachEvent("onLinkDblClick",function(a){var b=gantt.getLink(a);return b.url_edit&&plugin_dhtmlxGantt.util_openUrl(b.url_edit),apex.event.trigger(plugin_dhtmlxGantt.chartContainerIdElement,"dhtmlxgantt_link_double_click",b),!1}),gantt.attachEvent("onBeforeLinkAdd",function(a,b){return gantt.isLinkAllowed(b)&&apex.event.trigger(plugin_dhtmlxGantt.chartContainerIdElement,"dhtmlxgantt_link_create",b),!1}),gantt.attachEvent("onAfterTaskDrag",function(a,b,c){var d={mode:b,task:gantt.getTask(a)};apex.event.trigger(plugin_dhtmlxGantt.chartContainerIdElement,"dhtmlxgantt_task_drag",d)}),plugin_dhtmlxGantt.load(),apex.jQuery(window).on("apexwindowresized",function(a){gantt.render()}),apex.jQuery("#t_Button_navControl").click(function(){setTimeout(function(){gantt.render()},500)})},plugin_dhtmlxGantt.load=function(a){apex.event.trigger(plugin_dhtmlxGantt.regionIdElement,"apexbeforerefresh"),a?plugin_dhtmlxGantt.parse(a):plugin_dhtmlxGantt.queryDefined?apex.server.plugin(plugin_dhtmlxGantt.pluginId,{p_debug:$v("pdebug"),pageItems:plugin_dhtmlxGantt.pageItems},{loadingIndicator:plugin_dhtmlxGantt.chartContainerIdElement,loadingIndicatorPosition:"centered",success:function(a){plugin_dhtmlxGantt.parse(a)},error:function(a,b,c){plugin_dhtmlxGantt.util_logError("Unable to load data - message from jQuery AJAX call: "+a.responseText),apex.event.trigger(plugin_dhtmlxGantt.regionIdElement,"apexafterrefresh")},dataType:"text"}):plugin_dhtmlxGantt.parse({tasks:[{id:1,text:"Project #1 (NO REGION QUERY DEFINED: EXAMPLE DATA USED)",start_date:"2017-04-01",duration:11,progress:.6,open:!0},{id:2,text:"Task #1",start_date:"2017-04-03",duration:5,progress:1,open:!0,parent:1},{id:3,text:"Task #2",start_date:"2017-04-02",duration:7,progress:.5,open:!0,parent:1},{id:4,text:"Task #2.1",start_date:"2017-04-03",duration:2,progress:1,open:!0,parent:3},{id:5,text:"Task #2.2",start_date:"2017-04-04",duration:3,progress:.8,open:!0,parent:3},{id:6,text:"Task #2.3",start_date:"2017-04-05",duration:4,progress:.2,open:!0,parent:3}],links:[{id:1,source:1,target:2,type:"1"},{id:2,source:1,target:3,type:"1"},{id:3,source:3,target:4,type:"1"},{id:4,source:4,target:5,type:"0"},{id:5,source:5,target:6,type:"0"}],holidays:[{date:"2017-04-04"}]})},plugin_dhtmlxGantt.parse=function(a){if(a&&(plugin_dhtmlxGantt.dataRaw=a),plugin_dhtmlxGantt.dataRaw.constructor===Object)plugin_dhtmlxGantt.dataParsed=plugin_dhtmlxGantt.dataRaw;else if(plugin_dhtmlxGantt.dataRaw.constructor===String)if("<"===plugin_dhtmlxGantt.dataRaw.trim().substr(0,1)){try{plugin_dhtmlxGantt.dataParsed=plugin_dhtmlxGantt.util_xml2json(plugin_dhtmlxGantt.util_parseXml(plugin_dhtmlxGantt.dataRaw))}catch(a){plugin_dhtmlxGantt.util_logError("Unable to parse XML string: "+a.message)}null===plugin_dhtmlxGantt.dataParsed&&plugin_dhtmlxGantt.util_logError("Unable to parse XML string")}else if("{"===plugin_dhtmlxGantt.dataRaw.trim().substr(0,1))try{plugin_dhtmlxGantt.dataParsed=JSON.parse(plugin_dhtmlxGantt.dataRaw)}catch(a){plugin_dhtmlxGantt.util_logError("Unable to parse JSON string - please check for valid JSON before use here in plugin (e.g. https://jsonformatter.curiousconcept.com): "+a.message)}else plugin_dhtmlxGantt.util_logError('Your data string is not starting with "<" or "{" - parsing not possible');else plugin_dhtmlxGantt.util_logError("Unable to parse your data - input data can be a XML string, JSON string or JavaScript object.");if(plugin_dhtmlxGantt.dataParsed){!plugin_dhtmlxGantt.dataParsed.data&&plugin_dhtmlxGantt.dataParsed.tasks&&(plugin_dhtmlxGantt.dataParsed.data=plugin_dhtmlxGantt.dataParsed.tasks),plugin_dhtmlxGantt.dataParsed.data.forEach(function(a){a.progress=parseFloat(a.progress),a.duration=parseFloat(a.duration),a.open=plugin_dhtmlxGantt.util_parseBool(a.open)}),plugin_dhtmlxGantt.dataParsed.holidays&&plugin_dhtmlxGantt.dataParsed.holidays.length>0&&plugin_dhtmlxGantt.dataParsed.holidays.forEach(function(a){try{var b=a.date.split("-");gantt.setWorkTime({date:new Date(parseInt(b[0]),parseInt(b[1])-1,parseInt(b[2])),hours:!1})}catch(a){plugin_dhtmlxGantt.util_logError("unable to set a holiday with your data - format must be yyyy-mm-dd: "+a.message)}});try{gantt.clearAll(),gantt.parse(plugin_dhtmlxGantt.dataParsed)}catch(a){plugin_dhtmlxGantt.util_logError("vendor base library was unable to use your data: "+a.message)}}else plugin_dhtmlxGantt.util_logError("No data available for rendering");apex.event.trigger(plugin_dhtmlxGantt.regionIdElement,"apexafterrefresh")},plugin_dhtmlxGantt.util_parseXml=function(a){var b=null;if(a)if(window.DOMParser)try{b=(new DOMParser).parseFromString(a,"text/xml")}catch(a){b=null,plugin_dhtmlxGantt.util_logError("DOMParser - unable to parse XML: "+a.message)}else if(window.ActiveXObject)try{b=new ActiveXObject("Microsoft.XMLDOM"),b.async=!1,b.loadXML(a)||plugin_dhtmlxGantt.util_logError("Microsoft.XMLDOM - unable to parse XML: "+b.parseError.reason+b.parseError.srcText)}catch(a){b=null,plugin_dhtmlxGantt.util_logError("Microsoft.XMLDOM - unable to parse XML: "+a.message)}return b},plugin_dhtmlxGantt.util_xml2json=function(a){var b,c,d,e,f,g=null,h=function(a){if(b={},a.attributes.length>0)for(var c=0;c<a.attributes.length;c++)f=a.attributes.item(c),b[f.nodeName]=f.nodeValue;if(a.hasChildNodes())for(var e=0;e<a.childNodes.length;e++)d=a.childNodes.item(e),d.hasChildNodes()?b[d.nodeName]=d.childNodes.item(0).nodeValue:b[d.nodeName]="";return b};if(a&&(g={},g.data=[],g.links=[],g.holidays=[],a.childNodes.item(0).hasChildNodes()))for(var i=0;i<a.childNodes.item(0).childNodes.length;i++)b=null,c=a.childNodes.item(0).childNodes.item(i),e=c.nodeName,"task"===e||"tasks"===e||"data"===e?g.data.push(h(c)):"link"===e||"links"===e?g.links.push(h(c)):"holiday"===e||"holidays"===e?g.holidays.push(h(c)):"task_create_url_no_child"!==e&&"link_create_url_template"!==e||(g[e]=h(c));return g},plugin_dhtmlxGantt.util_parseBool=function(a){switch(String(a).trim().toLowerCase()){case"true":case"yes":case"y":case"1":return!0;case"false":case"no":case"n":case"0":case"":return!1;default:return!1}},plugin_dhtmlxGantt.util_openUrl=function(a){var b=apex.jQuery("a.dhtmlxgantt-open-url-helper:first");b.attr("href",a),b[0].click()},plugin_dhtmlxGantt.util_toLocalIsoString=function(a){function b(a){return a<10?"0"+a:a}var c=a.getFullYear()+"-"+b(a.getMonth()+1)+"-"+b(a.getDate())+"T"+b(a.getHours())+":"+b(a.getMinutes())+":"+b(a.getSeconds());return 0===a.getTimezoneOffset()&&(c+="Z"),c},plugin_dhtmlxGantt.util_round=function(a,b){var c=Math.pow(10,b),d=a*c;return Math.round(d)/c},plugin_dhtmlxGantt.util_logError=function(a){console.error("Plugin dhtmlxGantt: "+a),gantt.message({type:"error",text:"Plugin dhtmlxGantt: "+a,expire:-1})};